<!DOCTYPE html>
<html>
<head>
    <!--<meta http-equiv="Content-Type" content="charset=utf-8">-->
    <meta charset="utf-8">
    <title></title>
    <script type="text/javascript" src="javascripts/jquery/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="javascripts/underscore/underscore-min.js"></script>
    <script type="text/javascript" src="javascripts/backbone/backbone-min.js"></script>
    <script type="text/javascript" src="javascripts/handlebars/handlebars-1.0.0.beta.6.js"></script>
    <script id="food_template" type="text/x-handlebars-template">
        <div> 食品名称 :{{name}}</div>
        <div> 食品价格 :{{price}}</div>
        <div> 食品厂商 :{{vendor}}</div>
    </script>
</head>
<body>
<div id="food"></div>
<div id="toolBar">
    <button id="addButton">创建</button>
    <button id="updateButton">修改</button>
    <button id="refreshButton">刷新</button>
    <button id="delButton">删除</button>
</div>
<script>
    var Food = Backbone.Model.extend({
        urlRoot:'/food'
    });

    var food = new Food({
        name:'沙琪玛',
        price:24.50,
        vendor:'稻香村'
    });
    //View定义一定要用Backbone.View.extend
    var FoodView = Backbone.View.extend({
        tagName:'div',
        render:function () {
            var template = Handlebars.compile($('#food_template').html());
            $(template(this.model.toJSON())).appendTo(this.$el);
            return this;
        }
    });

    var foodView = new FoodView;
    foodView.model = food;
    foodView.render().$el.appendTo($('#food'));

    var ToolBarView = Backbone.View.extend({
        el:'#toolBar',
        events:{
            'click button':'action'
        },
        action:function(event){
            console.log('do action:'+$(event.target).html());
            switch($(event.target).html()){
                case '创建' :
                    food.save();
                    break;
                case '修改' :
                    food.id = 1;
                    food.save();
                    break;

                case '刷新' :
                    var f = new Food({id:1});
                    f.fetch();
                    break;

                case '删除' :
                    console.log('delete');
                    var f = new Food({id:1});
                    f.destroy();
                    break;

                default:

                    break;
            }
        }
    });
    var toolBarView = new ToolBarView;
</script>

</body>
</html>